# R Code for Political Public Self Paper
# Marshall A. Taylor

# Necessary packages
library(gdata)
library(ca)

# Reading in data ("Workbooks" are from crosstabs in Stata)
mydata8 <- read.csv("Ownership_Workbook.csv", row.names=1)
mydata9 <- read.csv("Salience_Workbook.csv", row.names=1)
mydata8 <- t(mydata8)
mydata9 <- t(mydata9)

# Running correspondence analyses
test <- ca(mydata8)
test2 <- ca(mydata9)

# Plotting CA
rownames(mydata8) <- paste("issue_ownership", 1:10, sep = " ")
plot(test, labels=c(1, 1), col.lab=c("black", "darkgrey"), xlab="First Dimension", 
     ylab="Second Dimension")
rownames(mydata9) <- paste("issue_salience", 1:10, sep = " ")
plot(test2, labels=c(1, 1), col.lab=c("black", "darkgrey"), xlab="First Dimension", 
     ylab="Second Dimension")
print(test)
summary(test)
print(test2)
summary(test2)
head(test$colcoord)

# Creating heat maps to replace cross-tabulations.
issue_owner <- t(mydata8)
pheatmap(issue_owner, show_rownames=T, show_colnames=T, digits=1, display_numbers=T, 
         treeheight_row=0, treeheight_col=0, cluster_rows=F, cluster_cols=F, 
         number_format="%.0f", brewer.pal(8, "Greys"), filename="issue_owner_hmap.pdf", 
         width=20, height=10)
draw_colnames_45 <- function(coln, ...) {
  m = length(coln)
  x = (1:m)/m - 1/2/m
  grid.text(coln, x=x, y=unit(0.96, "npc"), vjust=.5,
            hjust=1, rot=45, gp = gpar(...))
}
assignInNamespace(x="draw_colnames", value="draw_colnames_45",
                  ns=asNamespace("pheatmap"))
issue_salience <- t(mydata9)
pheatmap(issue_salience, show_rownames=T, show_colnames=T, digits=1, display_numbers=T, 
         treeheight_row=0, treeheight_col=0, cluster_rows=F, cluster_cols=F, 
         number_format="%.0f", brewer.pal(8, "Greys"), 
         filename="issue_salience_hmap.pdf", width=20, height=10)

# To change x-axis back.
assignInNamespace(x="draw_colnames", value="draw_colnames",
                  ns=asNaespace("pheatmap"))
